"use strict";(self.webpackChunkysapy_web=self.webpackChunkysapy_web||[]).push([[846],{7846:(ie,P,l)=>{l.r(P),l.d(P,{FuncionarioModule:()=>ee});var d=l(6895),x=l(2367),t=l(8256),y=l(1334);let S=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-main"]],decls:2,vars:0,template:function(e,o){1&e&&t._UZ(0,"app-menu-funcionario")(1,"router-outlet")},dependencies:[x.lC,y.e]}),i})();var n=l(4006),g=l(6386),Z=l(9019),u=l(262),m=l(3900),f=l(4004),h=l(9646),A=l(529),T=l(4099);let v=(()=>{class i{constructor(e,o){this.http=e,this.errorS=o,this.apiUrl=`${Z.N.API_URL}/api`}
//! --- Cabecera de Inventario ---
verExiteApertura(){return this.http.get(`${this.apiUrl}/inventarios/verExisteApertura`).pipe((0,u.K)(this.errorS.handleError))}sucDeUsuario(){return this.http.get(`${this.apiUrl}/inventarios/sucDeUsuario`).pipe((0,u.K)(this.errorS.handleError))}obtenerDatosCabecera(){return this.verExiteApertura().pipe((0,m.w)(e=>e.habilitado?this.sucDeUsuario().pipe((0,f.U)(o=>({mostrar:!0,descripcion:e.descripcion,sucursal:o.sucursal}))):(0,h.of)({mostrar:!1,descripcion:e.descripcion,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura})))}crearApertura(e){return this.http.post(`${this.apiUrl}/inventarios/crearApertura`,{...e}).pipe((0,u.K)(this.errorS.handleError))}
//! --- Invetario de productos ---
verificarInventario(){return this.http.get(`${this.apiUrl}/inventarios/verificarInventario`).pipe((0,u.K)(this.errorS.handleError))}productosInventario(){return this.http.get(`${this.apiUrl}/inventarios/productosInventario`).pipe((0,u.K)(this.errorS.handleError))}obtenerDatosProducto(){return this.verificarInventario().pipe((0,m.w)(e=>e.habilitado?this.productosInventario().pipe((0,f.U)(o=>({mostrar:!0,descripcion:e.descripcion,productos:o.producto,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura}))):(0,h.of)({mostrar:!1,descripcion:e.descripcion,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura})))}registrarInventario(e){return this.http.post(`${this.apiUrl}/inventarios/registrarInventario`,{...e}).pipe((0,u.K)(this.errorS.handleError))}
//! --- Rendicion caja ---
verificarRendicion(){return this.http.get(`${this.apiUrl}/inventarios/verificarRendicion`).pipe((0,u.K)(this.errorS.handleError))}dinerosRendicion(){return this.http.get(`${this.apiUrl}/inventarios/dinerosRendicion`).pipe((0,u.K)(this.errorS.handleError))}obtenerDatosDinero(){return this.verificarRendicion().pipe((0,m.w)(e=>e.habilitado?this.dinerosRendicion().pipe((0,f.U)(o=>({mostrar:!0,descripcion:e.descripcion,dineros:o.dinero,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura}))):(0,h.of)({mostrar:!1,descripcion:e.descripcion,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura})))}registrarRendicion(e){return this.http.post(`${this.apiUrl}/inventarios/registrarRendicion`,{...e}).pipe((0,u.K)(this.errorS.handleError))}obtenerProductoPorId(e){return this.http.get(`${this.apiUrl}/inventarios/producto/${e}`).pipe((0,u.K)(this.errorS.handleError))}visualizarInventarios(){return this.http.get(`${this.apiUrl}/inventarios/visualizarInventario`).pipe((0,u.K)(this.errorS.handleError))}obtenerDatosVisualizar(){return this.verExiteApertura().pipe((0,m.w)(e=>e.habilitado?(0,h.of)({mostrar:!1,descripcion:e.descripcion}):this.visualizarInventarios().pipe((0,f.U)(o=>({mostrar:!0,descripcion:e.descripcion,dinventario:o.dInventario,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura})))))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(A.eN),t.LFG(T.g))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const O=["*"];let C=(()=>{class i{constructor(e){this.mensajeAlertify=e,this.idModal="",this.guardarClick=new t.vpe,this.eliminarClick=new t.vpe}guardar(){this.guardarClick.emit(),this.mostrarModal(this.idModal,!1)}eliminar(){this.mostrarModal(this.idModal,!1),this.mensajeAlertify.mensajeError("Operaci\xf3n Cancelada")}mostrarModal(e,o){o?$(`#${e}`).modal("show"):$(`#${e}`).modal("hide")}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(g.v))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-modal-confirmar"]],inputs:{idModal:"idModal"},outputs:{guardarClick:"guardarClick",eliminarClick:"eliminarClick"},ngContentSelectors:O,decls:14,vars:1,consts:[["tabindex","-1","aria-labelledby","modalLabel","aria-hidden","true",1,"modal","fade",3,"id"],[1,"modal-dialog","modal-dialog-scrollable"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"modal-footer"],[1,"btn","e-tercer-boton",3,"click"],[1,"btn","e-primer-boton",3,"click"]],template:function(e,o){1&e&&(t.F$t(),t.TgZ(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"h1",4),t._uU(5,"Confirme la operaci\xf3n"),t.qZA(),t._UZ(6,"button",5),t.qZA(),t.TgZ(7,"div",6),t.Hsn(8),t.qZA(),t.TgZ(9,"div",7)(10,"button",8),t.NdJ("click",function(){return o.guardar()}),t._uU(11,"Aceptar"),t.qZA(),t.TgZ(12,"button",9),t.NdJ("click",function(){return o.eliminar()}),t._uU(13,"Cancelar"),t.qZA()()()()()),2&e&&t.Q6J("id",o.idModal)}}),i})();function R(i,a){if(1&i&&(t.TgZ(0,"p",10),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Fecha Apertura: ",t.lcZ(2,1,e.fechaApertura),"")}}function N(i,a){if(1&i&&(t.TgZ(0,"p",10),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Nro Inventario: ",e.idCabeceraInv,"")}}function j(i,a){if(1&i&&(t.TgZ(0,"p",10),t._uU(1),t.ALo(2,"number"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("TOTAL COBRADO: ",t.lcZ(2,1,e.calcularTotalCaja()),"")}}function E(i,a){1&i&&(t.TgZ(0,"div",11)(1,"div",12)(2,"span",13),t._uU(3,"Loading..."),t.qZA()()())}function M(i,a){1&i&&(t.TgZ(0,"div",5)(1,"div",11)(2,"div",14)(3,"span",13),t._uU(4,"Loading..."),t.qZA()()()())}function w(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",17)(1,"div",18)(2,"button",19),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.confirmarOperacionEnvio())}),t._uU(3,"Enviar"),t.qZA()()()}}function J(i,a){if(1&i&&(t.TgZ(0,"span",34),t._uU(1),t.qZA()),2&i){const e=t.oxw().index,o=t.oxw(3);t.xp6(1),t.hij(" ",o.mensajeValidacion("cantidad",o.form.get("dineroControles").get(e.toString()))," ")}}function D(i,a){if(1&i&&(t.TgZ(0,"span",34),t._uU(1),t.qZA()),2&i){const e=t.oxw().index,o=t.oxw(3);t.xp6(1),t.hij(" ",o.mensajeValidacion("observacion",o.form.get("dineroControles").get(e.toString()))," ")}}function k(i,a){if(1&i&&(t.TgZ(0,"tr",26)(1,"td",27),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td",28),t._uU(5),t.ALo(6,"number"),t.qZA(),t.TgZ(7,"td",29)(8,"div"),t._UZ(9,"input",30),t.YNc(10,J,2,1,"span",31),t.qZA()(),t.TgZ(11,"td",32)(12,"div"),t._UZ(13,"input",33),t.YNc(14,D,2,1,"span",31),t.qZA()()()),2&i){const e=a.$implicit,o=a.index,r=t.oxw(3);t.Q6J("formGroupName",o),t.xp6(2),t.Oqu(t.lcZ(3,6,e.nombreBillete)),t.xp6(3),t.Oqu(t.lcZ(6,8,e.monto)),t.xp6(4),t.Q6J("id","dineroControles-"+o+"-cantidad"),t.xp6(1),t.Q6J("ngIf",r.datoInvalido("cantidad","dineroControles",o)),t.xp6(4),t.Q6J("ngIf",r.datoInvalido("observacion","dineroControles",o))}}function Q(i,a){if(1&i&&(t.TgZ(0,"form",20)(1,"div",21)(2,"div",22)(3,"table",23)(4,"thead",24)(5,"tr")(6,"th",11),t._uU(7,"NOMBRE"),t.qZA(),t.TgZ(8,"th",11),t._uU(9,"MONTO"),t.qZA(),t.TgZ(10,"th",11),t._uU(11,"CANTIDAD"),t.qZA(),t.TgZ(12,"th",11),t._uU(13,"OBSERVACION"),t.qZA()()(),t.TgZ(14,"tbody"),t.YNc(15,k,15,10,"tr",25),t.qZA()()()()()),2&i){const e=t.oxw(2);t.Q6J("formGroup",e.form),t.xp6(15),t.Q6J("ngForOf",e.dineros)}}function Y(i,a){if(1&i&&(t.TgZ(0,"div",4),t.YNc(1,w,4,0,"div",15),t.TgZ(2,"div",5),t.YNc(3,Q,16,2,"form",16),t.qZA()()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.invHabilitado),t.xp6(2),t.Q6J("ngIf",e.invHabilitado)}}const L=function(i,a){return{"text-danger":i,"text-warning":a}};let F=(()=>{class i{constructor(e,o,r){this.mensajeAlertify=e,this.servicioR=o,this.fb=r,this.dineros=[],this.cargandoTabla=!1,this.invHabilitado=!1,this.descripcion="",this.dtOptions={paging:!1,info:!1,responsive:!0,searching:!1,ordering:!1,language:{search:"Buscar:",zeroRecords:"No se encontraron resultados",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",infoEmpty:"Mostrando 0 a 0 de 0 registros",infoFiltered:"(filtrados de _MAX_ registros en total)",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:"Primero",last:"\xdaltimo",next:"Siguiente",previous:"Anterior"}}},this.form=this.fb.group({dineroControles:this.fb.array([])})}ngOnInit(){this.consultarDetalle()}mensajeValidacion(e,o){let r="";return o.get(e)?.invalid&&(o.get(e)?.touched||o.get(e)?.dirty)&&(o.get(e)?.errors?.required&&(r="Es requerido"),o.get(e)?.errors?.min&&(r="M\xednimo 0")),r}datoInvalido(e,o,r){const s=this.form.get(o)?.get(`${r}.${e}`),c=(s?.touched||s?.dirty)&&s?.invalid,p=document.getElementById(`${o}-${r}-${e}`);return c?p?.classList.add("is-invalid"):(s?.touched||s?.dirty)&&s?.valid?(p?.classList.remove("is-invalid"),p?.classList.add("is-valid")):(p?.classList.remove("is-invalid"),p?.classList.remove("is-valid")),c||!1}enviar(){if(!this.form.valid)return void this.form.markAllAsTouched();this.cargandoOperacion=!0;let e=this.form.getRawValue();this.servicioR.registrarRendicion(e).subscribe({next:o=>{this.cargandoOperacion=!1,this.mensajeAlertify.mensajeExito(`${o.msg}`),this.consultarDetalle()},error:o=>{o.forEach(r=>{this.mensajeAlertify.mensajeError(r)}),this.cargandoOperacion=!1}})}consultarDetalle(){this.cargandoTabla=!0,this.servicioR.obtenerDatosDinero().subscribe({next:e=>{this.descripcion=e.descripcion,this.fechaApertura=e.fechaApertura,this.idCabeceraInv=e.idCabeceraInv,e.mostrar?(this.invHabilitado=!0,this.dineros=e.dineros,console.log(e.dineros),this.dineroControles=this.form.get("dineroControles"),this.dineros.forEach(o=>{const r=this.dineroControles.controls.find(s=>s.get("idBillete")?.value===o.idBillete);if(r instanceof n.cw)r.get("cantidad")?.setValue(0),r.get("observacion")?.setValue(""),r.markAsUntouched(),r.markAsPristine(),r.updateValueAndValidity();else{const s=this.fb.group({monto:[o.monto],cantidad:[0,[n.kI.required,n.kI.min(0)]],observacion:[""],idBillete:[o.idBillete],entrada:[o.entrada]});this.dineroControles.push(s)}})):this.invHabilitado=!1,this.cargandoTabla=!1},error:e=>{e.forEach(o=>{this.mensajeAlertify.mensajeError(o)}),this.cargandoTabla=!1}})}calcularTotalCaja(){let e=0,o=0,r=0,s=0;return this.dineroControles=this.form.get("dineroControles"),this.dineroControles.controls.forEach(c=>{o=c.get("cantidad")?.value,r=c.get("monto")?.value,s=c.get("entrada")?.value,3!=s&&(e+=o*r)}),e}mostrarModal(e,o){o?$(`#${e}`).modal("show"):$(`#${e}`).modal("hide")}confirmarOperacionEnvio(){this.mostrarModal("modMensajeId",!0)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(g.v),t.Y36(v),t.Y36(n.qu))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-rendicion-caja"]],decls:16,vars:13,consts:[[1,"container","py-2"],[1,"text-center","text-dark-emphasis"],[1,"fw-bold",3,"ngClass"],["class","text-secondary",4,"ngIf"],[1,"row"],[1,"col-12"],["class","text-center",4,"ngIf"],["class","col-12",4,"ngIf"],["class","row",4,"ngIf"],[3,"idModal","guardarClick"],[1,"text-secondary"],[1,"text-center"],["role","status",1,"spinner-border","text-danger"],[1,"visually-hidden"],["role","status",1,"spinner-border","text-danger",2,"width","3rem","height","3rem"],["class","col offset-md-9 col-md-3",4,"ngIf"],[3,"formGroup",4,"ngIf"],[1,"col","offset-md-9","col-md-3"],[1,"d-grid","gap-2","my-2"],[1,"btn","btn-danger",3,"click"],[3,"formGroup"],["formArrayName","dineroControles"],[1,"table-responsive","pb-4"],[1,"table","hover"],[1,"bg-warning"],[3,"formGroupName",4,"ngFor","ngForOf"],[3,"formGroupName"],["translate","no",1,"text-start"],[1,"text-end"],[1,"field-amount-size"],["type","number","formControlName","cantidad",1,"form-control",3,"id"],["class","e-mensaje-error",4,"ngIf"],[1,"field-description-size"],["type","text","formControlName","observacion",1,"form-control"],[1,"e-mensaje-error"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h3",1),t._uU(2),t.qZA(),t.TgZ(3,"p",2),t._uU(4),t.qZA(),t.YNc(5,R,3,3,"p",3),t.YNc(6,N,2,1,"p",3),t.YNc(7,j,3,3,"p",3),t.TgZ(8,"div",4)(9,"div",5),t.YNc(10,E,4,0,"div",6),t.qZA(),t.YNc(11,M,5,0,"div",7),t.qZA(),t.YNc(12,Y,4,2,"div",8),t.qZA(),t.TgZ(13,"app-modal-confirmar",9),t.NdJ("guardarClick",function(){return o.enviar()}),t.TgZ(14,"p"),t._uU(15,"Desea Guardar los Datos ?"),t.qZA()()),2&e&&(t.xp6(2),t.Oqu("Detalle de caja"),t.xp6(1),t.Q6J("ngClass",t.WLB(10,L,!o.invHabilitado,o.invHabilitado)),t.xp6(1),t.Oqu(o.descripcion),t.xp6(1),t.Q6J("ngIf",o.fechaApertura),t.xp6(1),t.Q6J("ngIf",o.idCabeceraInv),t.xp6(1),t.Q6J("ngIf",o.invHabilitado),t.xp6(3),t.Q6J("ngIf",o.cargandoOperacion),t.xp6(1),t.Q6J("ngIf",o.cargandoTabla),t.xp6(1),t.Q6J("ngIf",!o.cargandoOperacion),t.xp6(1),t.Q6J("idModal","modMensajeId"))},dependencies:[d.mk,d.sg,d.O5,n._Y,n.Fj,n.wV,n.JJ,n.JL,n.sg,n.u,n.x0,n.CE,C,d.JJ,d.rS,d.uU],styles:[".field-amount-size[_ngcontent-%COMP%]{min-width:150px;max-width:150px}.field-description-size[_ngcontent-%COMP%]{min-width:400px;max-width:500px}.table-responsive[_ngcontent-%COMP%]{max-height:55vh;overflow-y:auto}.table[_ngcontent-%COMP%]{max-width:100%}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#ffc107}"]}),i})();var _=l(5415);function G(i,a){if(1&i&&(t.TgZ(0,"p",10),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Fecha Apertura: ",t.lcZ(2,1,e.fechaApertura),"")}}function B(i,a){if(1&i&&(t.TgZ(0,"p",10),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Nro Inventario: ",e.idCabeceraInv,"")}}function H(i,a){1&i&&(t.TgZ(0,"div",11)(1,"div",12)(2,"span",13),t._uU(3,"Loading..."),t.qZA()()())}function K(i,a){1&i&&(t.TgZ(0,"div",5)(1,"div",11)(2,"div",14)(3,"span",13),t._uU(4,"Loading..."),t.qZA()()()())}function z(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",16)(1,"div",17)(2,"button",18),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.confirmarOperacionEnvio())}),t._uU(3,"Enviar"),t.qZA()()()}}function V(i,a){if(1&i&&(t.TgZ(0,"span",30),t._uU(1),t.qZA()),2&i){const e=t.oxw().$implicit,o=t.oxw(4);t.xp6(1),t.Oqu(o.mensaje(e.idProducto.toString()))}}function X(i,a){if(1&i&&(t.TgZ(0,"tr")(1,"td",25),t._uU(2),t.ALo(3,"titlecase"),t.qZA(),t.TgZ(4,"td",26),t._uU(5),t.ALo(6,"number"),t.qZA(),t.TgZ(7,"td",27)(8,"div"),t._UZ(9,"input",28),t.YNc(10,V,2,1,"span",29),t.qZA()()()),2&i){const e=a.$implicit,o=t.oxw(4);t.xp6(2),t.Oqu(t.lcZ(3,5,e.nombre)),t.xp6(3),t.Oqu(t.lcZ(6,7,e.precio)),t.xp6(4),t.s9C("formControlName",e.idProducto),t.Q6J("id",e.idProducto),t.xp6(1),t.Q6J("ngIf",o.datoInvalido(e.idProducto.toString()))}}function W(i,a){if(1&i&&(t.TgZ(0,"form",21)(1,"table",22)(2,"thead",23)(3,"tr")(4,"th",11),t._uU(5,"NOMBRE"),t.qZA(),t.TgZ(6,"th",11),t._uU(7,"PRECIO"),t.qZA(),t.TgZ(8,"th",11),t._uU(9,"CANTIDAD"),t.qZA()()(),t.TgZ(10,"tbody"),t.YNc(11,X,11,9,"tr",24),t.qZA()()()),2&i){const e=t.oxw(3);t.Q6J("formGroup",e.form),t.xp6(1),t.Q6J("dtOptions",e.dtOptions),t.xp6(10),t.Q6J("ngForOf",e.productos)}}function tt(i,a){if(1&i&&(t.TgZ(0,"div",5)(1,"div",19),t.YNc(2,W,12,3,"form",20),t.qZA()()),2&i){const e=t.oxw(2);t.xp6(2),t.Q6J("ngIf",e.invHabilitado)}}function et(i,a){if(1&i&&(t.TgZ(0,"div",4),t.YNc(1,z,4,0,"div",15),t.YNc(2,tt,3,1,"div",7),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.invHabilitado),t.xp6(1),t.Q6J("ngIf",!e.cargandoTabla&&!e.cargandoOperacion)}}const ot=function(i,a){return{"text-danger":i,"text-warning":a}};let it=(()=>{class i{constructor(e,o){this.mensajeAlertify=e,this.servicioI=o,this.productos=[],this.cargandoTabla=!1,this.invHabilitado=!1,this.descripcion="",this.form=new n.cw({}),this.dtOptions={ordering:!1,paging:!1,info:!1,responsive:!0,searching:!0,language:{search:"Buscar:",zeroRecords:"No se encontraron resultados",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",infoEmpty:"Mostrando 0 a 0 de 0 registros",infoFiltered:"(filtrados de _MAX_ registros en total)",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:"Primero",last:"\xdaltimo",next:"Siguiente",previous:"Anterior"}}}}ngOnInit(){this.consultarDetalle()}mensaje(e){let o="";return this.form.get(e)?.hasError("min")&&(o="Minimo 0"),this.form.get(e)?.hasError("required")&&(o="Es requerido"),o}datoInvalido(e){let o=(this.form.get(e)?.touched||this.form.get(e)?.dirty)&&this.form.get(e)?.invalid,r=document.getElementById(e);return o?r?.classList.add("is-invalid"):(this.form.get(e)?.touched||this.form.get(e)?.dirty)&&this.form.get(e)?.valid?(r?.classList.remove("is-invalid"),r?.classList.add("is-valid")):(r?.classList.remove("is-invalid"),r?.classList.remove("is-valid")),o}enviar(){this.form.valid?(this.cargandoOperacion=!0,this.servicioI.registrarInventario({productos:this.form.value}).subscribe({next:o=>{this.cargandoOperacion=!1,this.mensajeAlertify.mensajeExito(`${o.msg}`),this.consultarDetalle()},error:o=>{o.forEach(r=>{this.mensajeAlertify.mensajeError(r)}),this.cargandoOperacion=!1}})):this.form.markAllAsTouched()}consultarDetalle(){this.cargandoTabla=!0,this.servicioI.obtenerDatosProducto().subscribe({next:e=>{console.log(e),this.descripcion=e.descripcion,this.fechaApertura=e.fechaApertura,this.idCabeceraInv=e.idCabeceraInv,e.mostrar?(this.invHabilitado=!0,this.productos=e.productos,this.productos.forEach(o=>{const r=o.idProducto.toString();this.form.contains(r)?(this.form.get(r)?.setValue(0),this.form.get(r)?.markAsUntouched(),this.form.get(r)?.markAsPristine(),this.form.get(r)?.updateValueAndValidity()):this.form.addControl(r,new n.NI(0,[n.kI.required,n.kI.min(0)]))})):this.invHabilitado=!1,this.cargandoTabla=!1},error:e=>{e.forEach(o=>{this.mensajeAlertify.mensajeError(o)}),this.cargandoTabla=!1}})}mostrarModal(e,o){o?$(`#${e}`).modal("show"):$(`#${e}`).modal("hide")}confirmarOperacionEnvio(){this.mostrarModal("modMensajeId",!0)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(g.v),t.Y36(v))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-inventario-productos"]],decls:15,vars:12,consts:[[1,"container","py-2"],[1,"text-center","text-dark-emphasis"],[1,"fw-bold",3,"ngClass"],["class","text-secondary",4,"ngIf"],[1,"row"],[1,"col-12"],["class","text-center",4,"ngIf"],["class","col-12",4,"ngIf"],["class","row",4,"ngIf"],[3,"idModal","guardarClick"],[1,"text-secondary"],[1,"text-center"],["role","status",1,"spinner-border","text-danger"],[1,"visually-hidden"],["role","status",1,"spinner-border","text-danger",2,"width","3rem","height","3rem"],["class","col offset-md-9 col-md-3",4,"ngIf"],[1,"col","offset-md-9","col-md-3"],[1,"d-grid","gap-2","my-2"],[1,"btn","btn-danger",3,"click"],[1,"table-responsive","pb-4"],["class","",3,"formGroup",4,"ngIf"],[1,"",3,"formGroup"],["datatable","",1,"table","hover",3,"dtOptions"],[1,"bg-warning"],[4,"ngFor","ngForOf"],["translate","no",1,"text-start"],[1,"text-end"],[1,"field-amount-size"],["type","number",1,"form-control",3,"formControlName","id"],["class","e-mensaje-error",4,"ngIf"],[1,"e-mensaje-error"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h3",1),t._uU(2),t.qZA(),t.TgZ(3,"p",2),t._uU(4),t.qZA(),t.YNc(5,G,3,3,"p",3),t.YNc(6,B,2,1,"p",3),t.TgZ(7,"div",4)(8,"div",5),t.YNc(9,H,4,0,"div",6),t.qZA(),t.YNc(10,K,5,0,"div",7),t.qZA(),t.YNc(11,et,3,2,"div",8),t.qZA(),t.TgZ(12,"app-modal-confirmar",9),t.NdJ("guardarClick",function(){return o.enviar()}),t.TgZ(13,"p"),t._uU(14,"Desea Guardar los Datos ?"),t.qZA()()),2&e&&(t.xp6(2),t.Oqu("Detalle De Inventario"),t.xp6(1),t.Q6J("ngClass",t.WLB(9,ot,!o.invHabilitado,o.invHabilitado)),t.xp6(1),t.Oqu(o.descripcion),t.xp6(1),t.Q6J("ngIf",o.fechaApertura),t.xp6(1),t.Q6J("ngIf",o.idCabeceraInv),t.xp6(3),t.Q6J("ngIf",o.cargandoOperacion),t.xp6(1),t.Q6J("ngIf",o.cargandoTabla),t.xp6(1),t.Q6J("ngIf",!o.cargandoOperacion),t.xp6(1),t.Q6J("idModal","modMensajeId"))},dependencies:[d.mk,d.sg,d.O5,n._Y,n.Fj,n.wV,n.JJ,n.JL,n.sg,n.u,_.G,C,d.JJ,d.rS,d.uU],styles:[".table-responsive[_ngcontent-%COMP%]{max-height:55vh;overflow-y:auto}.table[_ngcontent-%COMP%]{max-width:100%}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#ffc107;font-size:18px}"]}),i})();function rt(i,a){if(1&i&&(t.TgZ(0,"h6",9),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Fecha Apertura: ",t.lcZ(2,1,e.datosCabecera.fechaApertura),"")}}function at(i,a){if(1&i&&(t.TgZ(0,"h6",9),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Nro Inventario: ",e.datosCabecera.idCabeceraInv,"")}}function nt(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",10)(1,"div",11)(2,"label",12),t._uU(3,"Sucursal"),t.qZA(),t._UZ(4,"input",13),t.qZA(),t.TgZ(5,"div",14)(6,"label",15),t._uU(7,"Observacion"),t.qZA(),t._UZ(8,"input",16),t.qZA(),t.TgZ(9,"div",17)(10,"button",18),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.guardar())}),t._uU(11,"Registrar"),t.qZA()()()}}function st(i,a){1&i&&(t.TgZ(0,"div",6)(1,"div",19)(2,"div",20)(3,"span",21),t._uU(4,"Loading..."),t.qZA()()()())}function ct(i,a){1&i&&(t.TgZ(0,"div",6)(1,"div",19)(2,"div",20)(3,"span",21),t._uU(4,"Loading..."),t.qZA()()()())}const dt=function(i,a){return{"text-danger":i,"text-secondary":a}};let lt=(()=>{class i{constructor(e,o,r){this.formulario=e,this.mensajeAlertify=o,this.servicioI=r,this.cargandoOperacion=!1,this.cargandoDatos=!0,this.datosCabecera={mostrar:!1,descripcion:""}}ngOnInit(){this.form=this.formulario.group({nombreSucursal:[""],observacion:[""]}),this.form.get("nombreSucursal")?.disable(),this.consultarApertura()}guardar(){this.cargandoOperacion=!0;let{...e}=this.form.value;this.servicioI.crearApertura(e).subscribe({next:o=>{this.cargandoOperacion=!1,this.mensajeAlertify.mensajeExito(`${o.msg}`),this.consultarApertura()},error:o=>{o.forEach(r=>{this.mensajeAlertify.mensajeError(r)}),this.cargandoOperacion=!1}})}consultarApertura(){this.cargandoDatos=!0,this.servicioI.obtenerDatosCabecera().subscribe({next:e=>{console.log(e),this.datosCabecera=e,this.datosCabecera.mostrar&&this.form.get("nombreSucursal")?.setValue(e.sucursal?.nombre),this.cargandoDatos=!1},error:e=>{e.forEach(o=>{this.mensajeAlertify.mensajeError(o)}),this.cargandoDatos=!1}})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(n.qu),t.Y36(g.v),t.Y36(v))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-inv-rend-cabecera"]],decls:13,vars:11,consts:[[1,"container"],[1,"row","g-3",3,"formGroup"],[1,"col-12","pt-3"],[1,"text-center","text-dark-emphasis"],["class","text-secondary mt-3",4,"ngIf"],[1,"mt-3","fw-bold",3,"ngClass"],[1,"col-12"],["class","row g-3",4,"ngIf"],["class","col-12",4,"ngIf"],[1,"text-secondary","mt-3"],[1,"row","g-3"],[1,"col-md-4"],["for","nombre",1,"form-label"],["formControlName","nombreSucursal","type","text","id","nombreSucursal",1,"form-control"],[1,"col-md-8"],["for","precio",1,"form-label"],["formControlName","observacion","type","text","id","observacion",1,"form-control"],[1,"col-md-12","py-3","text-end"],[1,"btn","btn-warning",3,"click"],[1,"text-center"],["role","status",1,"spinner-border","text-danger",2,"width","3rem","height","3rem"],[1,"visually-hidden"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"form",1)(2,"div",2)(3,"h1",3),t._uU(4,"Datos de la Apertura"),t.qZA(),t.YNc(5,rt,3,3,"h6",4),t.YNc(6,at,2,1,"h6",4),t.TgZ(7,"h6",5),t._uU(8),t.qZA()(),t.TgZ(9,"div",6),t.YNc(10,nt,12,0,"div",7),t.qZA(),t.YNc(11,st,5,0,"div",8),t.YNc(12,ct,5,0,"div",8),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("formGroup",o.form),t.xp6(4),t.Q6J("ngIf",o.datosCabecera.fechaApertura),t.xp6(1),t.Q6J("ngIf",o.datosCabecera.idCabeceraInv),t.xp6(1),t.Q6J("ngClass",t.WLB(8,dt,!o.datosCabecera.mostrar,o.datosCabecera.mostrar)),t.xp6(1),t.Oqu(o.datosCabecera.descripcion),t.xp6(2),t.Q6J("ngIf",1==o.datosCabecera.mostrar),t.xp6(1),t.Q6J("ngIf",o.cargandoDatos),t.xp6(1),t.Q6J("ngIf",o.cargandoOperacion))},dependencies:[d.mk,d.O5,n._Y,n.Fj,n.JJ,n.JL,n.sg,n.u,d.uU]}),i})();var q=l(7579),U=l(2550);let ut=(()=>{class i{constructor(e,o,r){this.http=e,this.errorS=o,this.autService=r,this.apiUrl=`${Z.N.API_URL}/api`}getItems(){const e=localStorage.getItem("productosRecepcion");if(e){const{fecha:o,items:r,observacion:s,nroComprobante:c,uId:p}=JSON.parse(e),I=new Date(o),oe=new Date;if(I.toDateString()===oe.toDateString()&&p==this.autService.usuario.idUsuario)return{items:r,observacion:s,nroComprobante:c}}return{}}saveItems(e,o="",r=""){const c={fecha:(new Date).toISOString(),items:e,observacion:o,nroComprobante:r,uId:this.autService.usuario.idUsuario};localStorage.setItem("productosRecepcion",JSON.stringify(c))}removerItems(){localStorage.removeItem("productosRecepcion")}verExiteApertura(){return this.http.get(`${this.apiUrl}/recepciones/verExisteApertura`).pipe((0,u.K)(this.errorS.handleError))}productosRecepcion(){return this.http.get(`${this.apiUrl}/inventarios/productosInventario`).pipe((0,u.K)(this.errorS.handleError))}obtenerDatos(){return this.verExiteApertura().pipe((0,m.w)(e=>e.habilitado?this.productosRecepcion().pipe((0,f.U)(o=>({mostrar:!0,descripcion:e.descripcion,producto:o.producto,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura,proximoNroComprobante:e.proximoNroComprobante}))):(0,h.of)({mostrar:!1,descripcion:e.descripcion,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura})))}registrarRecepcion(e){return this.http.post(`${this.apiUrl}/recepciones/registrarRecepcion`,{...e}).pipe((0,u.K)(this.errorS.handleError))}visualizacionDisponible(){return this.http.get(`${this.apiUrl}/recepciones/visualizacionDisponible`).pipe((0,u.K)(this.errorS.handleError))}visualizarRecepciones(){return this.http.get(`${this.apiUrl}/recepciones/visualizarRecepciones`).pipe((0,u.K)(this.errorS.handleError))}obtenerDatosVisualizar(){return this.visualizacionDisponible().pipe((0,m.w)(e=>e.habilitado?this.visualizarRecepciones().pipe((0,f.U)(o=>({mostrar:!0,descripcion:e.descripcion,drecepcion:o.dRecepcion,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura}))):(0,h.of)({mostrar:!1,descripcion:e.descripcion,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura})))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(A.eN),t.LFG(T.g),t.LFG(U.Q))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function pt(i,a){if(1&i&&(t.TgZ(0,"p",19),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Oqu(e.descripcion)}}function mt(i,a){if(1&i&&(t.TgZ(0,"p",20),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Fecha Apertura: ",t.lcZ(2,1,e.fechaApertura),"")}}function ft(i,a){if(1&i&&(t.TgZ(0,"p",20),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Nro Inventario: ",e.idCabeceraInv,"")}}function ht(i,a){1&i&&(t.TgZ(0,"div",21)(1,"div",22)(2,"span",23),t._uU(3,"Loading..."),t.qZA()()())}function gt(i,a){1&i&&(t.TgZ(0,"div",5)(1,"div",21)(2,"div",24)(3,"span",23),t._uU(4,"Loading..."),t.qZA()()()())}function _t(i,a){if(1&i&&(t.TgZ(0,"small",53),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.mensaje("nroComprobante"))}}function vt(i,a){if(1&i&&(t.TgZ(0,"small",53),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.mensaje("observacion"))}}function bt(i,a){if(1&i&&(t.TgZ(0,"small",53),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.mensaje("idProducto"))}}function Ct(i,a){if(1&i&&(t.TgZ(0,"small",53),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.mensaje("nombre"))}}function xt(i,a){if(1&i&&(t.TgZ(0,"small",53),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.mensaje("cantidad"))}}function Zt(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",54)(1,"div",55)(2,"div",21)(3,"label",56),t._uU(4,"Buscar"),t.qZA(),t.TgZ(5,"button",57),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.buscar())}),t._UZ(6,"i",58),t.qZA()(),t.TgZ(7,"div",21)(8,"label",56),t._uU(9,"Agregar"),t.qZA(),t.TgZ(10,"button",57),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.agregar())}),t._UZ(11,"i",59),t.qZA()()()()}}function At(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"tr")(1,"td",21),t._uU(2),t.qZA(),t.TgZ(3,"td",61),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.TgZ(6,"td",21),t._uU(7),t.qZA(),t.TgZ(8,"td",21)(9,"button",27),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw(3);return t.KtG(c.confirmarEliminacion(s))}),t._UZ(10,"i",62),t.qZA()(),t.TgZ(11,"td",21)(12,"button",63),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw(3);return t.KtG(c.modificar(s))}),t._UZ(13,"i",64),t.qZA()()()}if(2&i){const e=a.$implicit,o=a.index;t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(t.lcZ(5,3,e.nombre)),t.xp6(3),t.Oqu(e.cantidad)}}function Tt(i,a){if(1&i&&(t.TgZ(0,"tbody"),t.YNc(1,At,14,5,"tr",60),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.productosRecibidos)}}function It(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",4)(1,"div",25)(2,"button",26),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.confirmarOperacionEnvio())}),t._uU(3,"Enviar"),t.qZA(),t.TgZ(4,"button",27),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.borrarDatos())}),t._uU(5,"Cancelar"),t.qZA()(),t.TgZ(6,"div",28)(7,"div",29)(8,"button",30),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.nuevo())}),t._uU(9,"Nuevo"),t.qZA()()(),t.TgZ(10,"div",5)(11,"h4",20),t._uU(12),t.ALo(13,"titlecase"),t.qZA(),t.TgZ(14,"form",31)(15,"div",32)(16,"div",33)(17,"label",34),t._uU(18,"Nro. Comprobante"),t.qZA(),t._UZ(19,"input",35),t.YNc(20,_t,2,1,"small",36),t.qZA(),t.TgZ(21,"div",37)(22,"label",38),t._uU(23,"Observacion"),t.qZA(),t._UZ(24,"input",39),t.YNc(25,vt,2,1,"small",36),t.qZA()()(),t._UZ(26,"hr"),t.TgZ(27,"div",4)(28,"div",37)(29,"form",40)(30,"div",32)(31,"div",33)(32,"label",41),t._uU(33,"Id"),t.qZA(),t.TgZ(34,"input",42),t.NdJ("blur",function(r){t.CHM(e);const s=t.oxw();return t.KtG(s.onInputBlur(r))}),t.qZA(),t.YNc(35,bt,2,1,"small",36),t.qZA(),t.TgZ(36,"div",43)(37,"label",44),t._uU(38,"Nombre"),t.qZA(),t._UZ(39,"input",45),t.YNc(40,Ct,2,1,"small",36),t.qZA(),t.TgZ(41,"div",46)(42,"label",47),t._uU(43,"Cantidad"),t.qZA(),t._UZ(44,"input",48),t.YNc(45,xt,2,1,"small",36),t.qZA()()()(),t.YNc(46,Zt,12,0,"div",49),t.qZA(),t._UZ(47,"br")(48,"hr"),t.qZA(),t.TgZ(49,"div",5)(50,"div",50)(51,"table",51)(52,"thead")(53,"tr")(54,"th",21),t._uU(55," No"),t.qZA(),t.TgZ(56,"th",21),t._uU(57," Nombre"),t.qZA(),t.TgZ(58,"th",21),t._uU(59," Cantidad "),t.qZA(),t.TgZ(60,"th",21),t._uU(61," Elim "),t.qZA(),t.TgZ(62,"th",21),t._uU(63," Modif "),t.qZA()()(),t.YNc(64,Tt,2,1,"tbody",52),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(12),t.hij("Accion: ",t.lcZ(13,12,e.accion),""),t.xp6(2),t.Q6J("formGroup",e.formCabecera),t.xp6(6),t.Q6J("ngIf",e.datoInvalido("nroComprobante")),t.xp6(5),t.Q6J("ngIf",e.datoInvalido("observacion")),t.xp6(4),t.Q6J("formGroup",e.formRecepcion),t.xp6(6),t.Q6J("ngIf",e.datoInvalido("idProducto")),t.xp6(5),t.Q6J("ngIf",e.datoInvalido("nombre")),t.xp6(5),t.Q6J("ngIf",e.datoInvalido("cantidad")),t.xp6(1),t.Q6J("ngIf",!e.cargandoProductos),t.xp6(5),t.Q6J("dtOptions",e.dtOptionsRecepcion)("dtTrigger",e.dtTrigger),t.xp6(13),t.Q6J("ngIf",!e.cargandoTabRecepcion)}}function Pt(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"tr",67),t.NdJ("dblclick",function(){const s=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.seleccionarProducto(s))}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td",61),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.ALo(8,"number"),t.qZA()()}if(2&i){const e=a.$implicit;t.xp6(2),t.Oqu(e.idProducto),t.xp6(2),t.Oqu(t.lcZ(5,3,e.nombre)),t.xp6(3),t.Oqu(t.lcZ(8,5,e.precio))}}function qt(i,a){if(1&i&&(t.TgZ(0,"table",65)(1,"thead")(2,"tr")(3,"th",21),t._uU(4," Id "),t.qZA(),t.TgZ(5,"th",21),t._uU(6," Nombre"),t.qZA(),t.TgZ(7,"th",21),t._uU(8," Precio "),t.qZA()()(),t.TgZ(9,"tbody"),t.YNc(10,Pt,9,7,"tr",66),t.qZA()()),2&i){const e=t.oxw();t.Q6J("dtOptions",e.dtOptionsProductos),t.xp6(10),t.Q6J("ngForOf",e.productos)}}let Ut=(()=>{class i{constructor(e,o,r,s,c){this.mensajeAlertify=e,this.fb=o,this.servicioP=r,this.detectorCambio=s,this.servicioC=c,this.dtOptionsRecepcion={paging:!1,info:!1,responsive:!1,searching:!1,language:{search:"Buscar:",zeroRecords:"No se encontraron resultados",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",infoEmpty:"Mostrando 0 a 0 de 0 registros",infoFiltered:"(filtrados de _MAX_ registros en total)",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",emptyTable:"No se han agregado registros",paginate:{first:"Primero",last:"\xdaltimo",next:"Siguiente",previous:"Anterior"}}},this.dtTrigger=new q.x,this.dtOptionsProductos={paging:!1,info:!1,responsive:!1,language:{search:"Buscar:",zeroRecords:"No se encontraron resultados",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",infoEmpty:"Mostrando 0 a 0 de 0 registros",infoFiltered:"(filtrados de _MAX_ registros en total)",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:"Primero",last:"\xdaltimo",next:"Siguiente",previous:"Anterior"}}},this.formCabecera=this.fb.group({observacion:[""],nroComprobante:["",[n.kI.required]]}),this.formRecepcion=this.fb.group({idProducto:["",[n.kI.required]],nombre:["",[n.kI.required]],cantidad:["",[n.kI.required,n.kI.min(1)]]}),this.invHabilitado=!1,this.descripcion="",this.productos=[],this.productosRecibidos=[],this.accion="Crear",this.cargandoTabRecepcion=!1,this.cargandoOperacion=!1,this.cargandoProductos=!1}ngOnInit(){this.formRecepcion.get("nombre")?.disable(),this.cargandoProductos=!0,this.cargandoTabRecepcion=!0,this.servicioP.obtenerDatos().subscribe({next:e=>{if(this.cargandoProductos=!1,this.invHabilitado=e.mostrar,this.descripcion=e.descripcion,this.fechaApertura=e.fechaApertura,this.idCabeceraInv=e.idCabeceraInv,this.invHabilitado){this.productos=e.producto,this.proximoNroComprobante=e.proximoNroComprobante,this.formCabecera.get("nroComprobante")?.setValue(this.proximoNroComprobante.toString());let o=this.servicioP.getItems();o.items&&(this.productosRecibidos=o.items)}this.cargandoProductos=!1,this.establecerDatos(),this.cargandoTabRecepcion=!1},error:e=>{e.forEach(o=>{this.mensajeAlertify.mensajeError(o)}),this.cargandoProductos=!1}})}establecerDatos(){this.detectorCambio.detectChanges(),this.dtTrigger.next(0)}renderizar(){this.dtElement.dtInstance.then(e=>{e.destroy()})}ngOnDestroy(){this.dtTrigger.unsubscribe()}mostrarModal(e,o){o?$(`#${e}`).modal("show"):$(`#${e}`).modal("hide")}agregar(){if(!(this.formRecepcion.get("idProducto")?.value||this.formRecepcion.get("nombre")?.value||this.idProductoSeleccionado))return void this.mensajeAlertify.mensajeError("Seleccione el producto");if(!this.formRecepcion.valid)return void this.formRecepcion.markAllAsTouched();let{observacion:e,nroComprobante:o}=this.formCabecera.value;e=e??"",o=o??"";let r=this.formRecepcion.value;r.idProducto=this.idProductoSeleccionado,r.nombre=this.formRecepcion.get("nombre")?.value,console.log(r);let s=!1;"Crear"==this.accion?(this.cargandoTabRecepcion=!0,this.productosRecibidos.forEach((c,p)=>{c.idProducto==r.idProducto&&(this.productosRecibidos[p].cantidad=this.productosRecibidos[p].cantidad+r.cantidad,s=!0)}),s||this.productosRecibidos.push(r),this.dtElement.dtInstance.then(c=>{c.destroy(),this.dtTrigger.next(0)}),this.cargandoTabRecepcion=!1):"Modificar"==this.accion&&this.productosRecibidos.forEach((c,p)=>{c.idProducto==r.idProducto&&(this.productosRecibidos[p]=this.formRecepcion.value)}),this.limpiarDetalle(),this.accion="Crear",this.servicioP.saveItems(this.productosRecibidos,e,o)}nuevo(){this.accion="Crear",this.limpiarDetalle()}confirmarEliminacion(e){this.mensajeAlertify.mensajeConfirmacion(`Desea quitar el producto ${e.nombre} ?`,()=>this.eliminar(e.idProducto))}eliminar(e){this.accion="Eliminar";let{observacion:o,nroComprobante:r}=this.formCabecera.value;o=o??"",r=r??"",this.cargandoTabRecepcion=!0,this.productosRecibidos.forEach((s,c)=>{s.idProducto==e&&this.productosRecibidos.splice(c,1)}),this.dtElement.dtInstance.then(s=>{s.destroy(),this.dtTrigger.next(0)}),this.cargandoTabRecepcion=!1,this.accion="Crear",this.servicioP.saveItems(this.productosRecibidos,o,r)}modificar(e){this.accion="Modificar",this.formRecepcion.setValue(e)}buscar(){this.mostrarModal("smodal",!0)}seleccionarProducto(e){this.idProductoSeleccionado=e.idProducto,this.formRecepcion.get("idProducto")?.setValue(e.idProducto),this.formRecepcion.get("nombre")?.setValue(e.nombre),this.mostrarModal("smodal",!1)}mensaje(e){let o="";return this.formRecepcion.get(e)?.hasError("required")&&"cantidad"==e&&(o="La cantidad es requerida.."),this.formRecepcion.get(e)?.hasError("min")&&"cantidad"==e&&(o="La cantidad m\xednima es 0"),o}datoInvalido(e){let o=(this.formRecepcion.get(e)?.touched||this.formRecepcion.get(e)?.dirty)&&this.formRecepcion.get(e)?.invalid,r=document.getElementById(e);return o?r?.classList.add("is-invalid"):(this.formRecepcion.get(e)?.touched||this.formRecepcion.get(e)?.dirty)&&this.formRecepcion.get(e)?.valid?(r?.classList.remove("is-invalid"),r?.classList.add("is-valid")):(r?.classList.remove("is-invalid"),r?.classList.remove("is-valid")),o}guardar(){if(this.productosRecibidos.length<1)return void this.mensajeAlertify.mensajeError("Agregue al menos 1 producto !!");if(!this.formCabecera.valid)return void this.mensajeAlertify.mensajeError("Agregue el N\xfamero de comprobante !!");let e={nroComprobante:this.formCabecera.value.nroComprobante||"",observacion:this.formCabecera.value.observacion||"",productos:this.productosRecibidos};this.cargandoOperacion=!0,this.servicioP.registrarRecepcion(e).subscribe({next:o=>{this.cargandoOperacion=!1,this.mensajeAlertify.mensajeExito(`${o.msg}`),this.borrarDatos(),this.formCabecera.get("nroComprobante")?.setValue((this.proximoNroComprobante+1).toString())},error:o=>{o.forEach(r=>{this.mensajeAlertify.mensajeError(r)}),this.cargandoOperacion=!1}})}borrarDatos(){this.servicioP.removerItems(),this.formCabecera.reset(),this.formRecepcion.reset(),this.cargandoTabRecepcion=!0,this.productosRecibidos=[],this.dtElement.dtInstance.then(e=>{e.destroy(),console.log("Destruyendo.."),this.dtTrigger.next(0)}),this.cargandoTabRecepcion=!1}limpiarDetalle(){this.formRecepcion.reset()}onInputBlur(e){this.obtenerProducto()}obtenerProducto(){let e=this.formRecepcion.get("idProducto")?.value;e?this.servicioC.obtenerProductoPorId(e).subscribe({next:o=>{this.formRecepcion.get("nombre")?.setValue(o.nombre),this.idProductoSeleccionado=e},error:o=>{o.forEach(r=>{this.mensajeAlertify.mensajeError(r)}),this.cargandoOperacion=!1}}):this.mensajeAlertify.mensajeError("Establezca el id de Producto - "+e)}obtenerDatosRec(){this.cargandoProductos=!0,this.cargandoTabRecepcion=!0,this.servicioP.obtenerDatos().subscribe({next:e=>{if(this.cargandoProductos=!1,this.invHabilitado=e.mostrar,this.descripcion=e.descripcion,this.invHabilitado){this.productos=e.producto,this.fechaApertura=e.fechaApertura,this.idCabeceraInv=e.idCabeceraInv,this.formCabecera.get("nroComprobante")?.setValue(e.proximoNroComprobante.toString());let o=this.servicioP.getItems();o.items&&(this.productosRecibidos=o.items)}this.cargandoProductos=!1,this.establecerDatos(),this.cargandoTabRecepcion=!1},error:e=>{e.forEach(o=>{this.mensajeAlertify.mensajeError(o)}),this.cargandoProductos=!1}})}confirmarOperacionEnvio(){this.mostrarModal("modMensajeId",!0)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(g.v),t.Y36(n.qu),t.Y36(ut),t.Y36(t.sBO),t.Y36(v))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-recepcion-productos"]],viewQuery:function(e,o){if(1&e&&t.Gf(_.G,5),2&e){let r;t.iGM(r=t.CRH())&&(o.dtElement=r.first)}},decls:24,vars:8,consts:[[1,"container","mt-2"],[1,"text-center","text-dark-emphasis"],["class","text-danger fw-bold",4,"ngIf"],["class","text-secondary",4,"ngIf"],[1,"row"],[1,"col-12"],["class","text-center",4,"ngIf"],["class","col-12",4,"ngIf"],["class","row",4,"ngIf"],["id","smodal","tabindex","-1","aria-labelledby","modalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-scrollable","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"table-responsive","pb-2"],["class","table","datatable","",3,"dtOptions",4,"ngIf"],[3,"idModal","guardarClick"],[1,"text-danger","fw-bold"],[1,"text-secondary"],[1,"text-center"],["role","status",1,"spinner-border","text-danger"],[1,"visually-hidden"],["role","status",1,"spinner-border","text-danger",2,"width","3rem","height","3rem"],[1,"col-12","d-flex","justify-content-end","my-3"],[1,"btn","btn-warning","me-2",3,"click"],[1,"btn","btn-danger",3,"click"],[1,"col-12","offset-md-9","col-md-3"],[1,"d-grid","gap-2"],[1,"btn","e-tercer-boton","fw-bold","my-4",3,"click"],[1,"mt-3",3,"formGroup"],[1,"row","g-3"],[1,"col-md-3"],["for","nroComprobante",1,"form-label"],["formControlName","nroComprobante","type","number","id","nroComprobante",1,"form-control"],["class","e-mensaje-error",4,"ngIf"],[1,"col-md-9"],["for","observacion",1,"form-label"],["formControlName","observacion","type","text","id","observacion",1,"form-control"],[3,"formGroup"],["for","idProducto",1,"form-label"],["formControlName","idProducto","type","number","id","idProducto",1,"form-control",3,"blur"],[1,"col-md-6"],["for","nombre",1,"form-label"],["formControlName","nombre","type","text","id","nombre",1,"form-control"],[1,"col-md-3","col-xl-3"],["for","cantidad",1,"form-label"],["formControlName","cantidad","type","number","id","cantidad",1,"form-control"],["class","col-md-3 col-xl-2",4,"ngIf"],[1,"table-responsive"],["datatable","",1,"table","hover",3,"dtOptions","dtTrigger"],[4,"ngIf"],[1,"e-mensaje-error"],[1,"col-md-3","col-xl-2"],[1,"d-grid","gap-2","d-flex","justify-content-end"],["for","cantidad",1,"form-label","fw-bold","d-block"],[1,"btn","btn-secondary",3,"click"],[1,"bi","bi-search"],[1,"bi","bi-plus-square"],[4,"ngFor","ngForOf"],["translate","no"],[1,"bi","bi-trash3"],[1,"btn","btn-warning",3,"click"],[1,"bi","bi-arrow-up-right-square"],["datatable","",1,"table",3,"dtOptions"],[3,"dblclick",4,"ngFor","ngForOf"],[3,"dblclick"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h3",1),t._uU(2,"Recepcion de productos"),t.qZA(),t.YNc(3,pt,2,1,"p",2),t.YNc(4,mt,3,3,"p",3),t.YNc(5,ft,2,1,"p",3),t.TgZ(6,"div",4)(7,"div",5),t.YNc(8,ht,4,0,"div",6),t.qZA(),t.YNc(9,gt,5,0,"div",7),t.qZA(),t.YNc(10,It,65,14,"div",8),t.qZA(),t.TgZ(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"h1",13),t._uU(16,"Productos"),t.qZA(),t._UZ(17,"button",14),t.qZA(),t.TgZ(18,"div",15)(19,"div",16),t.YNc(20,qt,11,2,"table",17),t.qZA()()()()(),t.TgZ(21,"app-modal-confirmar",18),t.NdJ("guardarClick",function(){return o.guardar()}),t.TgZ(22,"p"),t._uU(23,"Desea Guardar los Datos ?"),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("ngIf",!o.invHabilitado),t.xp6(1),t.Q6J("ngIf",o.fechaApertura),t.xp6(1),t.Q6J("ngIf",o.idCabeceraInv),t.xp6(3),t.Q6J("ngIf",o.cargandoOperacion),t.xp6(1),t.Q6J("ngIf",o.cargandoProductos||o.cargandoTabRecepcion),t.xp6(1),t.Q6J("ngIf",o.invHabilitado&&!o.cargandoOperacion),t.xp6(10),t.Q6J("ngIf",o.productos.length>0),t.xp6(1),t.Q6J("idModal","modMensajeId"))},dependencies:[d.sg,d.O5,n._Y,n.Fj,n.wV,n.JJ,n.JL,n.sg,n.u,_.G,C,d.JJ,d.rS,d.uU],styles:[".container[_ngcontent-%COMP%]{max-height:80vh;overflow-y:auto}"]}),i})();var yt=l(4128);let St=(()=>{class i{constructor(e,o,r){this.http=e,this.errorS=o,this.autService=r,this.apiUrl=`${Z.N.API_URL}/api`}getItems(){const e=localStorage.getItem("productosBaja");if(e){const{fecha:o,items:r,observacion:s,uId:c}=JSON.parse(e),p=new Date(o),I=new Date;if(p.toDateString()===I.toDateString()&&c==this.autService.usuario.idUsuario)return{items:r,observacion:s}}return{}}saveItems(e,o=""){const s={fecha:(new Date).toISOString(),items:e,observacion:o,uId:this.autService.usuario.idUsuario};localStorage.setItem("productosBaja",JSON.stringify(s))}removerItems(){localStorage.removeItem("productosBaja")}verExiteApertura(){return this.http.get(`${this.apiUrl}/salidas/verExisteApertura`).pipe((0,u.K)(this.errorS.handleError))}productosSalida(){return this.http.get(`${this.apiUrl}/inventarios/productosInventario`).pipe((0,u.K)(this.errorS.handleError))}tiposSalida(){return this.http.get(`${this.apiUrl}/salidas/tiposSalida`).pipe((0,u.K)(this.errorS.handleError))}obtenerDatos(){return this.verExiteApertura().pipe((0,m.w)(e=>e.habilitado?(0,yt.D)([this.productosSalida(),this.tiposSalida()]).pipe((0,f.U)(o=>({mostrar:!0,descripcion:e.descripcion,producto:o[0].producto,salida:o[1].salida,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura}))):(0,h.of)({mostrar:!1,descripcion:e.descripcion,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura})))}registrarSalida(e){return console.log(e),this.http.post(`${this.apiUrl}/salidas/registrarSalida`,{...e}).pipe((0,u.K)(this.errorS.handleError))}visualizacionDisponible(){return this.http.get(`${this.apiUrl}/salidas/visualizacionDisponible`).pipe((0,u.K)(this.errorS.handleError))}visualizarSalidas(){return this.http.get(`${this.apiUrl}/salidas/visualizarSalidas`).pipe((0,u.K)(this.errorS.handleError))}obtenerDatosVisualizar(){return this.visualizacionDisponible().pipe((0,m.w)(e=>e.habilitado?this.visualizarSalidas().pipe((0,f.U)(o=>({mostrar:!0,descripcion:e.descripcion,dsalida:o.dSalida,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura}))):(0,h.of)({mostrar:!1,descripcion:e.descripcion,idCabeceraInv:e.idCabeceraInv,fechaApertura:e.fechaApertura})))}}return i.\u0275fac=function(e){return new(e||i)(t.LFG(A.eN),t.LFG(T.g),t.LFG(U.Q))},i.\u0275prov=t.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Ot(i,a){if(1&i&&(t.TgZ(0,"p",19),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Oqu(e.descripcion)}}function Rt(i,a){if(1&i&&(t.TgZ(0,"p",20),t._uU(1),t.ALo(2,"date"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Fecha Apertura: ",t.lcZ(2,1,e.fechaApertura),"")}}function Nt(i,a){if(1&i&&(t.TgZ(0,"p",20),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.hij("Nro Inventario: ",e.idCabeceraInv,"")}}function jt(i,a){1&i&&(t.TgZ(0,"div",21)(1,"div",22)(2,"span",23),t._uU(3,"Loading..."),t.qZA()()())}function Et(i,a){1&i&&(t.TgZ(0,"div",5)(1,"div",21)(2,"div",24)(3,"span",23),t._uU(4,"Loading..."),t.qZA()()()())}function Mt(i,a){if(1&i&&(t.TgZ(0,"small",58),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.mensaje("observacion"))}}function wt(i,a){if(1&i&&(t.TgZ(0,"small",58),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.mensaje("cantidad"))}}function Jt(i,a){if(1&i&&(t.TgZ(0,"option",59),t._uU(1),t.qZA()),2&i){const e=a.$implicit;t.Q6J("ngValue",e),t.xp6(1),t.Oqu(e.descripcion)}}function Dt(i,a){if(1&i&&(t.TgZ(0,"small",58),t._uU(1),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Oqu(e.mensaje("salida"))}}function kt(i,a){1&i&&(t.TgZ(0,"thead")(1,"tr")(2,"th",21),t._uU(3," No"),t.qZA(),t.TgZ(4,"th",21),t._uU(5," Nombre"),t.qZA(),t.TgZ(6,"th",21),t._uU(7," Cantidad "),t.qZA(),t.TgZ(8,"th",21),t._uU(9," Descripcion "),t.qZA(),t.TgZ(10,"th",21),t._uU(11," Elim "),t.qZA(),t.TgZ(12,"th",21),t._uU(13," Mod "),t.qZA()()())}function Qt(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"tr")(1,"td",21),t._uU(2),t.qZA(),t.TgZ(3,"td",61),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.TgZ(6,"td",21),t._uU(7),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA(),t.TgZ(10,"td",21)(11,"button",27),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw(3);return t.KtG(c.confirmarEliminacion(s))}),t._UZ(12,"i",62),t.qZA()(),t.TgZ(13,"td",21)(14,"button",63),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw(3);return t.KtG(c.modificar(s))}),t._UZ(15,"i",64),t.qZA()()()}if(2&i){const e=a.$implicit,o=a.index;t.xp6(2),t.Oqu(o+1),t.xp6(2),t.Oqu(t.lcZ(5,4,e.nombre)),t.xp6(3),t.Oqu(e.cantidad),t.xp6(2),t.Oqu(e.salida.descripcion)}}function Yt(i,a){if(1&i&&(t.TgZ(0,"tbody"),t.YNc(1,Qt,16,6,"tr",60),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngForOf",e.productosBaja)}}function Lt(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"div",4)(1,"div",25)(2,"button",26),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.confirmarOperacionEnvio())}),t._uU(3,"Enviar"),t.qZA(),t.TgZ(4,"button",27),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.borrarDatos())}),t._uU(5,"Borrar"),t.qZA()(),t.TgZ(6,"div",5)(7,"h4",20),t._uU(8),t.ALo(9,"titlecase"),t.qZA(),t.TgZ(10,"form",28)(11,"div",29)(12,"div",30)(13,"label",31),t._uU(14,"Observacion"),t.qZA(),t._UZ(15,"input",32),t.YNc(16,Mt,2,1,"small",33),t.qZA()()(),t._UZ(17,"hr"),t.TgZ(18,"div",4)(19,"div",34)(20,"form",35)(21,"div",29)(22,"div",36)(23,"label",37),t._uU(24,"Id"),t.qZA(),t.TgZ(25,"input",38),t.NdJ("blur",function(r){t.CHM(e);const s=t.oxw();return t.KtG(s.onInputBlur(r))}),t.qZA()(),t.TgZ(26,"div",36)(27,"label",39),t._uU(28,"Nombre"),t.qZA(),t._UZ(29,"input",40),t.qZA(),t.TgZ(30,"div",36)(31,"label",41),t._uU(32,"Cantidad"),t.qZA(),t._UZ(33,"input",42),t.YNc(34,wt,2,1,"small",33),t.qZA(),t.TgZ(35,"div",36)(36,"label",43),t._uU(37,"Tipo Salida"),t.qZA(),t.TgZ(38,"select",44),t.YNc(39,Jt,2,2,"option",45),t.qZA(),t.YNc(40,Dt,2,1,"small",33),t.qZA()()()(),t.TgZ(41,"div",46)(42,"div",47)(43,"div",21)(44,"label",48),t._uU(45,"Buscar"),t.qZA(),t.TgZ(46,"button",49),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.buscar())}),t._UZ(47,"i",50),t.qZA()(),t.TgZ(48,"div",21)(49,"label",48),t._uU(50,"Agregar"),t.qZA(),t.TgZ(51,"button",49),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.agregar())}),t._UZ(52,"i",51),t.qZA()()()()()(),t.TgZ(53,"div",52)(54,"div",53)(55,"button",54),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.nuevo())}),t._uU(56,"Nuevo"),t.qZA()()(),t.TgZ(57,"div",5)(58,"div",55)(59,"table",56),t.YNc(60,kt,14,0,"thead",57),t.YNc(61,Yt,2,1,"tbody",57),t.qZA()()()()}if(2&i){const e=t.oxw();t.xp6(8),t.hij("Accion: ",t.lcZ(9,11,e.accion),""),t.xp6(2),t.Q6J("formGroup",e.formCabecera),t.xp6(6),t.Q6J("ngIf",e.datoInvalido("observacion")),t.xp6(4),t.Q6J("formGroup",e.formSalida),t.xp6(14),t.Q6J("ngIf",e.datoInvalido("cantidad")),t.xp6(5),t.Q6J("ngForOf",e.salidas),t.xp6(1),t.Q6J("ngIf",e.datoInvalido("salida")),t.xp6(19),t.Q6J("dtOptions",e.dtOptions)("dtTrigger",e.dtTrigger),t.xp6(1),t.Q6J("ngIf",!e.cargandoTablaSalida),t.xp6(1),t.Q6J("ngIf",!e.cargandoTablaSalida)}}function Ft(i,a){if(1&i){const e=t.EpF();t.TgZ(0,"tr",68),t.NdJ("dblclick",function(){const s=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.seleccionarProducto(s))}),t.TgZ(1,"td"),t._uU(2),t.qZA(),t.TgZ(3,"td"),t._uU(4),t.ALo(5,"titlecase"),t.qZA(),t.TgZ(6,"td"),t._uU(7),t.ALo(8,"number"),t.qZA()()}if(2&i){const e=a.$implicit;t.xp6(2),t.Oqu(e.idProducto),t.xp6(2),t.Oqu(t.lcZ(5,3,e.nombre)),t.xp6(3),t.Oqu(t.lcZ(8,5,e.precio))}}function $t(i,a){if(1&i&&(t.TgZ(0,"table",65)(1,"thead")(2,"tr")(3,"th",21),t._uU(4," Id "),t.qZA(),t.TgZ(5,"th",66),t._uU(6," Nombre"),t.qZA(),t.TgZ(7,"th",21),t._uU(8," Precio "),t.qZA()()(),t.TgZ(9,"tbody"),t.YNc(10,Ft,9,7,"tr",67),t.qZA()()),2&i){const e=t.oxw();t.Q6J("dtOptions",e.dtOptionsProductos),t.xp6(10),t.Q6J("ngForOf",e.productos)}}let Gt=(()=>{class i{constructor(e,o,r,s,c){this.mensajeAlertify=e,this.fb=o,this.servicioP=r,this.detectorCambio=s,this.servicioC=c,this.dtOptions={paging:!1,info:!1,responsive:!1,searching:!1,language:{search:"Buscar:",zeroRecords:"No se encontraron resultados",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",infoEmpty:"Mostrando 0 a 0 de 0 registros",infoFiltered:"(filtrados de _MAX_ registros en total)",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",emptyTable:"No se han agregado registros",paginate:{first:"Primero",last:"\xdaltimo",next:"Siguiente",previous:"Anterior"}}},this.dtTrigger=new q.x,this.dtOptionsProductos={paging:!1,info:!1,responsive:!1,language:{search:"Buscar:",zeroRecords:"No se encontraron resultados",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",infoEmpty:"Mostrando 0 a 0 de 0 registros",infoFiltered:"(filtrados de _MAX_ registros en total)",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:"Primero",last:"\xdaltimo",next:"Siguiente",previous:"Anterior"}}},this.formCabecera=this.fb.group({observacion:["",[n.kI.required]]}),this.formSalida=this.fb.group({idProducto:["",[n.kI.required]],nombre:["",[n.kI.required]],cantidad:["",[n.kI.required,n.kI.min(1)]],salida:["",[n.kI.required]]}),this.invHabilitado=!1,this.descripcion="",this.productos=[],this.productosBaja=[],this.accion="Crear",this.cargandoTablaSalida=!1,this.cargandoOperacion=!1,this.cargandoProductos=!1,this.salidas=[]}ngOnInit(){this.formSalida.get("nombre")?.disable(),this.cargandoProductos=!0,this.cargandoTablaSalida=!0,this.servicioP.obtenerDatos().subscribe({next:e=>{if(this.invHabilitado=e.mostrar,this.descripcion=e.descripcion,this.fechaApertura=e.fechaApertura,this.idCabeceraInv=e.idCabeceraInv,console.log(" this.idCabeceraInv",this.idCabeceraInv),this.invHabilitado){this.productos=e.producto,this.salidas=e.salida;let o=this.servicioP.getItems();o.items&&(this.productosBaja=o.items,this.formCabecera.get("observacion")?.setValue(o.observacion))}this.cargandoProductos=!1,this.establecerDatos(),this.cargandoTablaSalida=!1},error:e=>{e.forEach(o=>{this.mensajeAlertify.mensajeError(o)}),this.cargandoTablaSalida=!1}})}establecerDatos(){this.detectorCambio.detectChanges(),this.dtTrigger.next(0)}renderizar(){this.dtElement.dtInstance.then(e=>{e.destroy()})}ngOnDestroy(){this.dtTrigger.unsubscribe()}mostrarModal(e,o){o?$(`#${e}`).modal("show"):$(`#${e}`).modal("hide")}agregar(){if(!(this.formSalida.get("idProducto")?.value||this.formSalida.get("nombre")?.value||this.idProductoSeleccionado))return void this.mensajeAlertify.mensajeError("Seleccione el producto");if(!this.formSalida.valid)return void this.formSalida.markAllAsTouched();let{observacion:e}=this.formCabecera.value;e=e??"";let o=this.formSalida.value;o.idProducto=this.idProductoSeleccionado,o.nombre=this.formSalida.get("nombre")?.value;let r=!1;"Crear"==this.accion?(this.cargandoTablaSalida=!0,this.productosBaja.forEach((s,c)=>{s.idProducto==o.idProducto&&(this.productosBaja[c].cantidad=this.productosBaja[c].cantidad+o.cantidad,r=!0)}),r||this.productosBaja.push(o),this.dtElement.dtInstance.then(s=>{s.destroy(),this.dtTrigger.next(0)}),this.cargandoTablaSalida=!1):"Modificar"==this.accion&&this.productosBaja.forEach((s,c)=>{s.idProducto==o.idProducto&&(this.productosBaja[c]=this.formSalida.value)}),this.limpiarDetalle(),this.accion="Crear",this.servicioP.saveItems(this.productosBaja,e)}nuevo(){this.accion="Crear",this.limpiarDetalle()}confirmarEliminacion(e){this.mensajeAlertify.mensajeConfirmacion(`Desea quitar el producto ${e.nombre} ?`,()=>this.eliminar(e.idProducto))}eliminar(e){this.accion="Eliminar";let{observacion:o}=this.formCabecera.value;o=o??"",this.cargandoTablaSalida=!0,this.productosBaja.forEach((r,s)=>{r.idProducto==e&&this.productosBaja.splice(s,1)}),this.dtElement.dtInstance.then(r=>{r.destroy(),this.dtTrigger.next(0)}),this.cargandoTablaSalida=!1,this.accion="Crear",this.servicioP.saveItems(this.productosBaja,o)}modificar(e){this.accion="Modificar",this.formSalida.setValue(e)}buscar(){this.mostrarModal("smodal",!0)}seleccionarProducto(e){this.idProductoSeleccionado=e.idProducto,this.formSalida.get("idProducto")?.setValue(e.idProducto),this.formSalida.get("nombre")?.setValue(e.nombre),this.mostrarModal("smodal",!1)}mensaje(e){let o="";return this.formSalida.get(e)?.hasError("required")&&("cantidad"==e&&(o="La cantidad es requerida.."),"salida"==e&&(o="El tipo es requerido..")),this.formSalida.get(e)?.hasError("min")&&"cantidad"==e&&(o="La cantidad m\xednima es 0"),o}datoInvalido(e){let o=(this.formSalida.get(e)?.touched||this.formSalida.get(e)?.dirty)&&this.formSalida.get(e)?.invalid,r=document.getElementById(e);return o?r?.classList.add("is-invalid"):(this.formSalida.get(e)?.touched||this.formSalida.get(e)?.dirty)&&this.formSalida.get(e)?.valid?(r?.classList.remove("is-invalid"),r?.classList.add("is-valid")):(r?.classList.remove("is-invalid"),r?.classList.remove("is-valid")),o}guardar(){if(this.productosBaja.length<1)return void this.mensajeAlertify.mensajeError("Agregue al menos 1 producto !!");let e={observacion:this.formCabecera.value.observacion||"",productos:this.productosBaja};this.cargandoOperacion=!0,this.servicioP.registrarSalida(e).subscribe({next:o=>{this.cargandoOperacion=!1,this.mensajeAlertify.mensajeExito(`${o.msg}`),this.borrarDatos()},error:o=>{o.forEach(r=>{this.mensajeAlertify.mensajeError(r)}),console.log(o),this.cargandoOperacion=!1}})}borrarDatos(){this.servicioP.removerItems(),this.formCabecera.reset(),this.formSalida.reset(),this.cargandoTablaSalida=!0,this.productosBaja=[],this.dtElement.dtInstance.then(e=>{e.destroy(),this.dtTrigger.next(0)}),this.cargandoTablaSalida=!1}limpiarDetalle(){this.formSalida.reset()}onInputBlur(e){this.obtenerProducto()}obtenerProducto(){let e=this.formSalida.get("idProducto")?.value;e?this.servicioC.obtenerProductoPorId(e).subscribe({next:o=>{this.formSalida.get("nombre")?.setValue(o.nombre),this.idProductoSeleccionado=e},error:o=>{o.forEach(r=>{this.mensajeAlertify.mensajeError(r)}),this.cargandoOperacion=!1}}):this.mensajeAlertify.mensajeError("Establezca el id de Producto - "+e)}confirmarOperacionEnvio(){this.mostrarModal("modMensajeId",!0)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(g.v),t.Y36(n.qu),t.Y36(St),t.Y36(t.sBO),t.Y36(v))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-salida-productos"]],viewQuery:function(e,o){if(1&e&&t.Gf(_.G,5),2&e){let r;t.iGM(r=t.CRH())&&(o.dtElement=r.first)}},decls:24,vars:8,consts:[[1,"container","mt-2"],[1,"text-center","text-dark-emphasis"],["class","text-danger fw-bold",4,"ngIf"],["class","text-secondary",4,"ngIf"],[1,"row"],[1,"col-12"],["class","text-center",4,"ngIf"],["class","col-12",4,"ngIf"],["class","row",4,"ngIf"],["id","smodal","tabindex","-1","aria-labelledby","modalLabel","aria-hidden","true",1,"modal","fade"],[1,"modal-dialog","modal-dialog-scrollable","modal-lg"],[1,"modal-content"],[1,"modal-header"],["id","exampleModalLabel",1,"modal-title","fs-5"],["type","button","data-bs-dismiss","modal","aria-label","Close",1,"btn-close"],[1,"modal-body"],[1,"table-responsive","pb-2"],["class","table","datatable","",3,"dtOptions",4,"ngIf"],[3,"idModal","guardarClick"],[1,"text-danger","fw-bold"],[1,"text-secondary"],[1,"text-center"],["role","status",1,"spinner-border","text-danger"],[1,"visually-hidden"],["role","status",1,"spinner-border","text-danger",2,"width","3rem","height","3rem"],[1,"col-12","d-flex","justify-content-end","my-3"],[1,"btn","btn-warning","me-2",3,"click"],[1,"btn","btn-danger",3,"click"],[1,"mt-3",3,"formGroup"],[1,"row","g-3"],[1,"col-md-12"],["for","observacion",1,"form-label"],["formControlName","observacion","type","text","id","observacion",1,"form-control"],["class","e-mensaje-error",4,"ngIf"],[1,"col-md-9"],[3,"formGroup"],[1,"col-md-6"],["for","idProducto",1,"form-label"],["formControlName","idProducto","type","number","id","idProducto",1,"form-control",3,"blur"],["for","nombre",1,"form-label"],["formControlName","nombre","type","text","id","nombre",1,"form-control"],["for","cantidad",1,"form-label"],["formControlName","cantidad","type","number","id","cantidad",1,"form-control"],["for","salida",1,"form-label"],["formControlName","salida","id","salida",1,"form-select"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"col-md-3","col-xl-2"],[1,"d-grid","gap-2","d-flex","justify-content-end"],["for","cantidad",1,"form-label","fw-bold","d-block"],[1,"btn","btn-secondary",3,"click"],[1,"bi","bi-search"],[1,"bi","bi-plus-square"],[1,"col-12","offset-md-9","col-md-3"],[1,"d-grid","gap-2"],[1,"btn","e-tercer-boton","fw-bold","my-4",3,"click"],[1,"table-responsive"],["datatable","",1,"table","hover",3,"dtOptions","dtTrigger"],[4,"ngIf"],[1,"e-mensaje-error"],[3,"ngValue"],[4,"ngFor","ngForOf"],["translate","no"],[1,"bi","bi-trash3"],[1,"btn","btn-warning",3,"click"],[1,"bi","bi-arrow-up-right-square"],["datatable","",1,"table",3,"dtOptions"],["translate","no",1,"text-center"],[3,"dblclick",4,"ngFor","ngForOf"],[3,"dblclick"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h1",1),t._uU(2,"Salida de productos"),t.qZA(),t.YNc(3,Ot,2,1,"p",2),t.YNc(4,Rt,3,3,"p",3),t.YNc(5,Nt,2,1,"p",3),t.TgZ(6,"div",4)(7,"div",5),t.YNc(8,jt,4,0,"div",6),t.qZA(),t.YNc(9,Et,5,0,"div",7),t.qZA(),t.YNc(10,Lt,62,13,"div",8),t.qZA(),t.TgZ(11,"div",9)(12,"div",10)(13,"div",11)(14,"div",12)(15,"h1",13),t._uU(16,"Productos"),t.qZA(),t._UZ(17,"button",14),t.qZA(),t.TgZ(18,"div",15)(19,"div",16),t.YNc(20,$t,11,2,"table",17),t.qZA()()()()(),t.TgZ(21,"app-modal-confirmar",18),t.NdJ("guardarClick",function(){return o.guardar()}),t.TgZ(22,"p"),t._uU(23,"Desea Guardar los Datos ?"),t.qZA()()),2&e&&(t.xp6(3),t.Q6J("ngIf",!o.invHabilitado),t.xp6(1),t.Q6J("ngIf",o.fechaApertura),t.xp6(1),t.Q6J("ngIf",o.idCabeceraInv),t.xp6(3),t.Q6J("ngIf",o.cargandoOperacion),t.xp6(1),t.Q6J("ngIf",o.cargandoTablaSalida||o.cargandoTablaSalida),t.xp6(1),t.Q6J("ngIf",o.invHabilitado&&!o.cargandoOperacion),t.xp6(10),t.Q6J("ngIf",o.productos.length>0),t.xp6(1),t.Q6J("idModal","modMensajeId"))},dependencies:[d.sg,d.O5,n._Y,n.YN,n.Kr,n.Fj,n.wV,n.EJ,n.JJ,n.JL,n.sg,n.u,_.G,C,d.JJ,d.rS,d.uU],styles:[".container[_ngcontent-%COMP%]{max-height:80vh;overflow-y:auto}"]}),i})();function Bt(i,a){1&i&&(t.TgZ(0,"div",7)(1,"div",8)(2,"span",9),t._uU(3,"Loading..."),t.qZA()()())}function Ht(i,a){if(1&i&&(t.TgZ(0,"tr")(1,"td",12),t._uU(2),t.qZA(),t.TgZ(3,"td",14),t._uU(4),t.qZA(),t.TgZ(5,"td",12),t._uU(6),t.ALo(7,"number"),t.qZA(),t.TgZ(8,"td"),t._uU(9),t.qZA()()),2&i){const e=a.$implicit;t.xp6(2),t.Oqu(e.idProducto),t.xp6(2),t.Oqu(e.nombre),t.xp6(2),t.Oqu(t.lcZ(7,4,e.precio)),t.xp6(3),t.Oqu(e.descripcion)}}function Kt(i,a){if(1&i&&(t.TgZ(0,"table",10)(1,"thead",11)(2,"tr")(3,"th",12),t._uU(4,"ID P"),t.qZA(),t.TgZ(5,"th",12),t._uU(6,"NOMBRE"),t.qZA(),t.TgZ(7,"th",12),t._uU(8,"PRECIO"),t.qZA(),t.TgZ(9,"th",12),t._uU(10,"DESCRIPCION"),t.qZA()()(),t.TgZ(11,"tbody"),t.YNc(12,Ht,10,6,"tr",13),t.qZA()()),2&i){const e=t.oxw();t.Q6J("dtOptions",e.dtOpciones),t.xp6(12),t.Q6J("ngForOf",e.productos)}}let zt=(()=>{class i{constructor(e,o){this.servicioI=e,this.mensajeAlertify=o,this.productos=[],this.cargandoTabla=!0,this.dtOpciones={paging:!1,info:!0,responsive:!1,pagingType:"simple_numbers",lengthChange:!1,pageLength:10,language:{search:"Buscar:",zeroRecords:"No se encontraron resultados",info:"Mostrando _START_ a _END_ de _TOTAL_ registros",infoEmpty:"Mostrando 0 a 0 de 0 registros",infoFiltered:"(filtrados de _MAX_ registros en total)",lengthMenu:"Mostrar _MENU_ registros",loadingRecords:"Cargando...",processing:"Procesando...",emptyTable:"No hay datos disponibles en la tabla",paginate:{first:"Primero",last:"\xdaltimo",next:"Siguiente",previous:"Anterior"}}}}ngOnInit(){this.cargandoTabla=!0,this.servicioI.productosInventario().subscribe({next:e=>{this.productos=e.producto,this.cargandoTabla=!1},error:e=>{e.forEach(o=>{this.mensajeAlertify.mensajeError(o)}),this.cargandoTabla=!1}})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(v),t.Y36(g.v))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-ver-productos"]],decls:9,vars:2,consts:[[1,"container","mt-2"],[1,"text-center","text-dark-emphasis"],[1,"row"],[1,"col-12"],["class","text-center mt-3",4,"ngIf"],[1,"table-responsive","pb-4"],["class","table hover","datatable","",3,"dtOptions",4,"ngIf"],[1,"text-center","mt-3"],["role","status",1,"spinner-border","text-danger",2,"width","3rem","height","3rem"],[1,"visually-hidden"],["datatable","",1,"table","hover",3,"dtOptions"],[1,"bg-warning"],[1,"text-center"],[4,"ngFor","ngForOf"],["translate","no"]],template:function(e,o){1&e&&(t.TgZ(0,"div",0)(1,"h3",1),t._uU(2,"Listado de productos"),t.qZA(),t.TgZ(3,"div",2)(4,"div",3),t.YNc(5,Bt,4,0,"div",4),t.qZA(),t.TgZ(6,"div",3)(7,"div",5),t.YNc(8,Kt,13,2,"table",6),t.qZA()()()()),2&e&&(t.xp6(5),t.Q6J("ngIf",o.cargandoTabla),t.xp6(3),t.Q6J("ngIf",!o.cargandoTabla))},dependencies:[d.sg,d.O5,_.G,d.JJ],styles:[".table-responsive[_ngcontent-%COMP%]{max-height:60vh;overflow-y:auto}.table[_ngcontent-%COMP%]{max-width:100%}.table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{position:sticky;top:0;background-color:#ffc107}"]}),i})();var b=l(7705);const Vt=[{path:"",component:S,children:[{path:"visualizarProductos",component:zt},{path:"salidaProductos",component:Gt,canDeactivate:[b.c]},{path:"recepcion",component:Ut,canDeactivate:[b.c]},{path:"rendicion",component:F,canDeactivate:[b.c]},{path:"inventario",component:it,canDeactivate:[b.c]},{path:"aperturaInventario",component:lt,canDeactivate:[b.c]},{path:"**",redirectTo:"usuario"}]}];let Xt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[x.Bz.forChild(Vt),x.Bz]}),i})();var Wt=l(9531),te=l(8390);let ee=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[d.ez,Xt,n.UX,_.T,Wt.H,te.U]}),i})()}}]);